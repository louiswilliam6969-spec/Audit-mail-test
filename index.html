<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMP Audits | Firm Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .gradient-bg { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); }
        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-slate-100 font-sans min-h-screen text-slate-900">

    <nav class="gradient-bg p-6 text-white shadow-lg mb-8">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-light tracking-widest uppercase">AMP<span class="font-bold text-blue-400">Audits</span></h1>
            <div class="text-sm opacity-80 font-medium">Partner Portal v5.0</div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="md:col-span-2 relative">
                <input type="text" id="auditSearch" onkeyup="render()" placeholder="Search clients..." 
                    class="w-full pl-12 pr-4 py-4 rounded-2xl border-none shadow-sm focus:ring-2 focus:ring-blue-500 text-lg">
                <i class="fas fa-search absolute left-4 top-5 text-slate-300 text-xl"></i>
            </div>
            
            <div onclick="toggleListView()" class="bg-blue-600 rounded-3xl p-6 text-white flex items-center justify-between shadow-xl cursor-pointer hover:bg-blue-700 transition-all active:scale-95">
                <div>
                    <p class="text-xs uppercase opacity-70 font-bold tracking-widest">Active Engagements</p>
                    <p id="totalCount" class="text-4xl font-bold">0</p>
                    <p class="text-[10px] mt-1 opacity-60 italic">Click to view full tracker</p>
                </div>
                <i class="fas fa-list-ul text-4xl opacity-30"></i>
            </div>
        </div>

        <div id="listViewPanel" class="hidden mb-8 glass rounded-3xl overflow-hidden shadow-2xl border border-blue-100 animate-in fade-in duration-300">
            <div class="bg-blue-50 p-4 border-b border-blue-100 flex justify-between items-center">
                <h3 class="font-bold text-blue-800 uppercase text-xs tracking-widest">Firm-Wide Engagement Tracker</h3>
                <button onclick="toggleListView()" class="text-blue-400 hover:text-blue-800 text-xl">&times;</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-slate-50 text-[10px] uppercase text-slate-400 font-bold">
                        <tr>
                            <th class="p-4">Client Name</th>
                            <th class="p-4">Partner</th>
                            <th class="p-4">Duration</th>
                            <th class="p-4">Status</th>
                        </tr>
                    </thead>
                    <tbody id="listTableBody" class="text-sm"></tbody>
                </table>
            </div>
        </div>

        <div class="flex gap-8 mb-6 border-b border-slate-200 px-2">
            <button onclick="setTab('ALL')" id="tabALL" class="pb-3 text-sm tab-active transition-all">All Audits</button>
            <button onclick="setTab('Completed')" id="tabCompleted" class="pb-3 text-sm text-slate-500 transition-all">Completed</button>
            <button onclick="setTab('Pending')" id="tabPending" class="pb-3 text-sm text-slate-500 transition-all">In Progress</button>
        </div>

        <div id="auditContainer" class="grid grid-cols-1 gap-4 pb-12"></div>
    </div>

    <div id="projectModal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-4xl rounded-3xl shadow-2xl overflow-hidden relative">
            <div class="gradient-bg p-8 text-white">
                <button onclick="closeModal()" class="absolute top-6 right-6 text-2xl opacity-50 hover:opacity-100">&times;</button>
                <h2 id="modalTitle" class="text-3xl font-bold mb-2 uppercase tracking-tight">--</h2>
                <div class="text-sm opacity-80">Partner: <span id="modalPartner">--</span> <span id="modalTarget" class="ml-4 font-bold text-blue-300"></span></div>
            </div>
            <div class="p-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-2 space-y-6">
                    <section>
                        <h4 class="text-slate-400 uppercase text-xs font-bold mb-3 tracking-widest">Audit Scope</h4>
                        <p id="modalDesc" class="text-slate-700 italic text-sm">--</p>
                    </section>
                    <section>
                        <h4 class="text-slate-400 uppercase text-xs font-bold mb-3 tracking-widest">Assigned Team</h4>
                        <div id="modalTeam" class="flex gap-4"></div>
                    </section>
                </div>
                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                    <h4 class="text-slate-800 font-bold mb-4 text-xs uppercase tracking-widest">Resources</h4>
                    <div class="space-y-3">
                        <a id="modalFolder" href="#" target="_blank" class="flex items-center justify-between w-full p-4 bg-white rounded-xl border border-slate-200 hover:border-blue-500 transition text-slate-700 group">
                            <span class="flex items-center gap-3"><i class="fas fa-folder-open text-amber-500"></i><span class="font-bold text-xs">Working Folder</span></span>
                            <i class="fas fa-external-link-alt text-[10px] opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                        <a id="modalChecklist" href="#" target="_blank" class="flex items-center justify-between w-full p-4 bg-white rounded-xl border border-slate-200 hover:border-blue-400 transition text-slate-700 group">
                            <span class="flex items-center gap-3"><i class="fas fa-tasks text-blue-400"></i><span class="font-bold text-xs">Audit Checklist</span></span>
                            <i class="fas fa-external-link-alt text-[10px] opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                        <a id="modalReport" href="#" target="_blank" class="flex items-center justify-between w-full p-4 bg-white rounded-xl border border-slate-200 hover:border-green-500 transition text-slate-700 group">
                            <span class="flex items-center gap-3"><i class="fas fa-file-excel text-green-600"></i><span class="font-bold text-xs">Final Report</span></span>
                            <i class="fas fa-external-link-alt text-[10px] opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRGzHkHY-7FP7s1cAC0BLRo3EENu8nHvUZxGbkBVeBAcaYlZGDWj_B8fjswfe6y3kcdBgo3h8IoeenL/pub?output=csv'; // Ensure link ends in &output=csv
        let audits = []; let currentTab = 'ALL';

        function loadData() {
            Papa.parse(sheetUrl, { download: true, header: true, skipEmptyLines: true, complete: function(results) { audits = results.data; render(); } });
        }

        function toggleListView() { document.getElementById('listViewPanel').classList.toggle('hidden'); }

        function getDaysRemaining(deadline) {
            if (!deadline) return null;
            return Math.ceil((new Date(deadline) - new Date().setHours(0,0,0,0)) / (1000 * 60 * 60 * 24));
        }

        function render() {
            const container = document.getElementById('auditContainer');
            const tableBody = document.getElementById('listTableBody');
            const search = document.getElementById('auditSearch').value.toLowerCase();
            const filtered = audits.filter(a => (currentTab === 'ALL' || a.Status === currentTab) && (a.Name?.toLowerCase().includes(search) || a.Partner?.toLowerCase().includes(search)));
            
            document.getElementById('totalCount').innerText = filtered.length;
            
            // Render Table Rows
            tableBody.innerHTML = filtered.map(a => `
                <tr class="border-b border-slate-50 hover:bg-slate-50 transition">
                    <td class="p-4 font-bold text-slate-700">${a.Name}</td>
                    <td class="p-4 text-slate-500 text-xs">${a.Partner}</td>
                    <td class="p-4 text-[10px] text-slate-400">${a.Date}</td>
                    <td class="p-4">
                        <span class="text-[10px] font-bold px-2 py-1 rounded-full ${a.Status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}">${a.Status}</span>
                    </td>
                </tr>`).join('');

            // Render Card List
            container.innerHTML = filtered.map(a => {
                const days = getDaysRemaining(a.Deadline);
                let badge = (a.Status === 'Pending' && days !== null) ? (days < 0 ? `<span class="bg-red-100 text-red-600 px-2 py-0.5 rounded-full text-[10px] font-bold ml-2">OVERDUE</span>` : `<span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full text-[10px] font-bold ml-2">${days} Days Left</span>`) : '';
                return `
                <div onclick="openModal('${a.Name.replace(/'/g, "\\'")}')" class="glass p-8 rounded-2xl shadow-sm hover:shadow-md transition cursor-pointer flex justify-between items-center border-l-4 ${a.Status === 'Completed' ? 'border-green-500' : 'border-amber-500'} group">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="text-xl font-bold text-slate-800 group-hover:text-blue-600 transition">${a.Name}</h3>
                            <span class="text-[10px] font-bold px-2 py-0.5 rounded-full ${a.Status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}">${a.Status}</span>
                            ${badge}
                        </div>
                        <p class="text-slate-400 text-sm">Partner: ${a.Partner} | ${a.Date}</p>
                    </div>
                    <i class="fas fa-chevron-right text-slate-200 group-hover:text-blue-600 transition"></i>
                </div>`;
            }).join('');
        }

        function setTab(tab) {
            currentTab = tab;
            ['ALL', 'Completed', 'Pending'].forEach(t => document.getElementById('tab'+t).className = t === tab ? 'pb-3 text-sm tab-active' : 'pb-3 text-sm text-slate-500');
            render();
        }

        function openModal(name) {
            const a = audits.find(item => item.Name === name); if (!a) return;
            document.getElementById('modalTitle').innerText = a.Name;
            document.getElementById('modalPartner').innerText = a.Partner;
            document.getElementById('modalTarget').innerText = a.Deadline ? `| Target: ${a.Deadline}` : "";
            document.getElementById('modalDesc').innerText = a.Description || "Project documentation.";
            
            // Resource Links
            const folder = document.getElementById('modalFolder'); folder.href = a.Folder || "#"; folder.target = "_blank";
            const report = document.getElementById('modalReport'); report.href = a.Report || "#"; report.target = "_blank";
            const checklist = document.getElementById('modalChecklist'); checklist.href = a.Checklist || "#"; checklist.target = "_blank";

            // Team Initials
            const team = a.Team ? a.Team.split(',') : [];
            document.getElementById('modalTeam').innerHTML = team.map(n => `
                <div class="text-center">
                    <div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 font-bold mb-1 border border-blue-100">${n.trim().charAt(0).toUpperCase()}</div>
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-tighter">${n.trim()}</p>
                </div>`).join('');
            document.getElementById('projectModal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('projectModal').classList.add('hidden'); }
        window.onclick = (e) => { if(e.target == document.getElementById('projectModal')) closeModal(); }
        window.onload = loadData;
    </script>
</body>
</html>
